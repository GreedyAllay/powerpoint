    <head>
        <link rel="stylesheet" href="style.css">
        <title>powerpoit ripoff</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    </head>

    <body>
        <div id="loading">
            im loading
            <noscript>
                <br><br>
            See, the thing here is, turning off your javascript is kind of a stupid thing. Do you REALLY think
            the creators of javascript couldn't make pages safe?
            </noscript>

        </div>
        <toolbar>
            <img src="assets/icon.svg" alt="" id="icon">
            <div id="toolbarstuff">
                <div contenteditable="true" id="title">please name me lord</div>
                <div id="toolbar">
                    <div class="toolbar-option"> File </div>
                    <div class="toolbar-option"> Edit </div>
                    <div class="toolbar-option"> Insert </div>
                    <div class="toolbar-option"> Layout </div>
                    <div class="toolbar-option"> Info </div>
                    </div>
            </div>
            </toolbar>

        <editor></editor>

        <script>
            const title = document.getElementById('title')
            const editor = document.getElementsByTagName('editor')[0]
            let shapes = {}
            let id = 0
            let mouse = {}
            let selected = null
            let dragging = null
            let selectedID = -1
            let offset = {}
            let dropdownselection = ''
            let dropdownMenus = {
                insert: ['box', 'circle', 'poop'],
                file: ['new', 'load', 'save'],
                layout: ['background color', 'border color', 'text color'],
                shape: ['copy', 'layout'],
                edit: ['background color']
            }
            title.addEventListener('blur', (e) => {
                if(title.textContent == '') {
                    title.textContent = 'Unnamed Thingie'
                }
                document.title = title.textContent + " - powerpoop "
            })
            title.addEventListener('keydown', (e) => {
                if(e.keyCode == 13) {
                    title.blur()
                }
            })
            const toolbar_el = document.getElementsByClassName('toolbar-option')
            for(let i = 0; i < toolbar_el.length; i++) {
                toolbar_el[i].addEventListener('click', (e) => {
                    toolbarClick(toolbar_el[i].textContent)
                    if(toolbar_el[i].textContent.includes('Insert')) {
                    }
                })
            }

            function updateProperties() {

            }

            document.getElementById('icon').addEventListener('click', (e) => {
                if(prompt('What did you expect? No, seriously, tell me. (this has an easter egg!!!)') == 'cat') {
                    const audio = new Audio()
                    const song = fetch('https://assets.cattiesworld.nl/music/glyde-latte.mp3')
                    .then(res => res.blob())
                    .then((songie) => {
                        const objectURL = URL.createObjectURL(songie);
                        audio.src = objectURL
                        audio.play()
                    })
                    
                }
            })

            function toolbarClick(option) {
                const sel = option.trim().toLowerCase()
                    rightClickMenu(dropdownMenus[sel])   
            }

            function insert(type) {
                if(type == 'box') {
                    const el = document.createElement('div')
                    el.className = 'box'
                    el.contentEditable = false
                    el.id = `editor-${id}`
                    let thisID = id
                    updateData(id, el)
                    el.addEventListener('mousedown', (e) => {
                        if(selected) {
                            selected.classList.remove('selected')
                        }
                        const me = el.getBoundingClientRect()
                        offset.x = e.clientX - me.left
                        offset.y = e.clientY - me.top
                        selected = el
                        selectedID = thisID
                        dragging = el
                        console.log(selected)

                        el.classList.add('selected')
                    })
                    el.addEventListener('mouseup', (e) => {
                        dragging = null
                        console.log(selected)
                    })
                    editor.appendChild(el)
                    id++
                }
            }

            addEventListener('mousemove', (e) => {
                mouse.x = e.clientX
                mouse.y = e.clientY
                if(dragging) {
                    dragging.style.left = mouse.x - offset.x +'px'
                    dragging.style.top = mouse.y - offset.y + 'px'
                    updateData(selectedID, dragging)
                }
            })

            let randomTitles = [
                'OH MY LORD',
                'may I be named good sir?',
                'my name is nameless',
                "i'm hungry, hi hungry im dad",
                'literally nothing',
                'AND HIS NAME IS...',
                'dont forget to name me',
                'nameless sadly',
                "I'd like a name",
                "hello? aren't you forgetting something?",
                'powerpoint ripoff'
            ]
            title.textContent = randomTitles[Math.floor(random(0, randomTitles.length))]

            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            function rightClickMenu(options) {
                const oldDropdown = document.getElementsByClassName('dropdown')[0]
                if(oldDropdown) {
                    oldDropdown.remove()
                }
                const dropdown = document.createElement('div')
                dropdown.className = 'dropdown'
                dropdown.style.left = mouse.x
                dropdown.style.top = mouse.y + 20
                for(let i = 0; i < options.length; i++) {
                    const item = document.createElement('div')
                    item.textContent = options[i]
                    item.className = 'dropdown-item'
                    dropdown.appendChild(item)
                    if(Math.floor(i/2) == i/2) {
                        item.style.backgroundColor = '#313131'
                    } else {
                        item.style.backgroundColor = '#363636'
                    }
                    item.addEventListener('click', () => {
                        dropdownselection = item.textContent
                        dropdownAction(0, dropdownselection)
                        dropdown.remove()
                    })
                }
                document.body.appendChild(dropdown)
            }

            document.addEventListener('contextmenu', event => {
            event.preventDefault();
            console.log(selected)
            if(selected) {
                rightClickMenu(['layout'])
            } else {
                rightClickMenu(['insert'])
            }
            
            })

            function dropdownAction(id, selection) {
                subMenus = ['insert', 'file']
                if(subMenus.includes(selection)) {
                    rightClickMenu(dropdownMenus[selection])
                } else if(selection == 'box') {
                    insert('box')
                } else if(selection == 'new') {
                    if(shapes) {
                        if(confirm('u sure u wanna throw that all away?')) {
                            shapes = {}
                            editor.innerHTML = ''
                        }
                    }
                } else if(selection == 'save') {
                    const data = JSON.stringify(shapes)
                        alert(`
                        it's in ur clipboard my man
                                                       `
                        )
                        navigator.clipboard.writeText(data);
                } else if(selection == 'background color') {
                    const picker = document.createElement('input')
                    picker.type = 'color'
                    picker.style.position = 'absolute'
                    picker.style.left = mouse.x
                    picker.style.left = mouse.y
                    picker.addEventListener('change', (e) => {
                        console.log(picker.value)
                        if(selected) {
                            selected.style.backgroundColor = picker.value
                        }
                    })
                    document.body.appendChild(picker)
                    picker.click()
                } else if(selection == 'layout') {
                    rightClickMenu(dropdownMenus['layout'])
                } else if(selection == 'backgroundcolor') {
                    editor.stle.backgroundColor = picker.value
                } else if(selection == 'load') {
                    loadProject(prompt('enter project data sir.'))
                }
                
            }

            function updateData(id, el) {
                const me = getComputedStyle(el);
                shapes[id] = {
                    x: me.offsetLeft, y: me.offsetTop, d: 0, w: me.offsetWidth, h: me.offsetHeight,
                    editable: false, type: 'box', color: me.backgroundColor,
                    border: me.borderColor,
                }
            }

            function setData(id) {
                const el = document.getElementById(`editor-${id}`)
                const data = shapes[id]
                console.log(data)
                el.style.backgroundColor = data.color
                el.style.left = data.x + 'px'
                el.style.top = data.y + 'px'
            }

            function loadProject(json) {
                shapes = JSON.parse(json)
                const objects = Object.keys(shapes)
                const count = objects.length
                for(let i = 0; i < count; i++) {
                    insert('box')
                    setData(i)
                }
            }

            editor.addEventListener('click', (e) => {
                if(e.currentTarget === e.target) {
                    if(selected) {
                        selected.classList.remove('selected')
                    }
                    selected = null
                    selectedID = -1
                }
                document.getElementsByClassName('dropdown')[0].remove()
            })

        </script>
    </body>

    <script>
        document.getElementById('loading').remove()
    </script>